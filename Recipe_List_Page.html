<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="recipe_list.css">
    <title>Recipe List</title>
    
</head>
<body>
    <div class="container">
        <nav>
            <div class="cookhub">
                <img src="imgs/WhatsApp Image 2025-04-02 at 22.45.22_80c2abde.jpg"/>
                <h1>CookHub</h1>
            </div>
            <div class="about">
                <a href="Home.html">Home</a>
                <a href="Recipe_List_Page.html">Recipes</a>
                <a id="Favorits" href="Favourite Page.html"></a>
                <a href="SearchPage.html">Find recipe</a>
                <a id="manage_recipes" href="Admin.html"></a>
            </div>
            <div class="about">
                <button id="logout"><i class="fa-solid fa-arrow-right"></i> LogOut</button>
            </div>
        </nav>
        <div class="content">
            <div id="recipeList"></div>
        </div>
    </div>

    <script>
        let user = localStorage.getItem("user");
        if(!user) {
            window.location.href ='Login.html';
        }   
        let userparse = JSON.parse(user);
        if(userparse.is_admin === "true") {
            document.getElementById("manage_recipes").innerHTML = "Manage recipes";
        } else {
            document.getElementById("Favorits").innerHTML = "Favorites";
        }
        
        let logout = document.getElementById("logout");
        logout.addEventListener('click', () => {
            localStorage.removeItem("user_data");
            window.location.href = "Login.html";
        });

        function loadRecipes() {
            const recipeList = document.getElementById("recipeList");
            let recipes = [];
            
            try {
                recipes = JSON.parse(localStorage.getItem("allRecipes")) || 
                         JSON.parse(localStorage.getItem("recipes")) || [];
            } catch (e) {
                console.error("Error loading recipes:", e);
            }
            
            recipeList.innerHTML = "";

            if (recipes.length === 0) {
                recipeList.innerHTML = '<p class="no-recipes">No recipes found. Add some recipes to see them here.</p>';
                return;
            }

            recipes.forEach(recipe => {
                const recipeCard = document.createElement("div");
                recipeCard.className = "recipe-card";
                recipeCard.dataset.id = recipe.id;
                recipeCard.dataset.name = recipe.name;
                recipeCard.dataset.course = recipe.courseName;

                let imageHtml = '';
                try {
                    imageHtml = `<img src="${recipe.image || 'imgs/default-recipe.jpg'}" alt="${recipe.name}" 
                               onerror="this.src='imgs/default-recipe.jpg'">`;
                } catch (e) {
                    imageHtml = `<div class="image-placeholder">No Image</div>`;
                }

                recipeCard.innerHTML = `
                    ${imageHtml}
                    <h3>${recipe.name || 'Unnamed Recipe'}</h3>
                    <p>${recipe.description || 'A delicious dish'}</p>
                    <div class="buttons-container">
                        <button class="favorite-btn"><i class="fa fa-heart"></i></button>
                        <button class="recipe-details">View details</button>
                    </div>
                `;

                recipeCard.querySelector(".recipe-details").addEventListener("click", function() {
                    window.location.href = `Recipe_details_Page.html?id=${recipe.id}`;
                });

                recipeList.appendChild(recipeCard);
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            loadRecipes();
            
            window.addEventListener('storage', function(event) {
                if (event.key === 'recipeUpdated') {
                    console.log('Recipe update detected, reloading...');
                    loadRecipes();
                }
            });

            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('updated')) {
                console.log(`Recipe ${urlParams.get('updated')} was recently updated`);
              
            }
        });
    </script>
    <script src="recipe_list.js"></script>
</body>
</html>
